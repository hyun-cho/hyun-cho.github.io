{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/TIL/Spring Boot/코드로-배우는-스프링부트/part4/파일 업로드 처리","result":{"data":{"markdownRemark":{"id":"3710cdbc-b154-5991-bc20-29a018ac90ea","html":"<h1 id=\"chapter-8-파일-업로드-처리\" style=\"position:relative;\"><a href=\"#chapter-8-%ED%8C%8C%EC%9D%BC-%EC%97%85%EB%A1%9C%EB%93%9C-%EC%B2%98%EB%A6%AC\" aria-label=\"chapter 8 파일 업로드 처리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Chapter 8 파일 업로드 처리</h1>\n<ul>\n<li>파일 업로드는 하나의 챕터로 나누었나보다</li>\n</ul>\n<h2 id=\"spring에서-파일업로드-하는-방식\" style=\"position:relative;\"><a href=\"#spring%EC%97%90%EC%84%9C-%ED%8C%8C%EC%9D%BC%EC%97%85%EB%A1%9C%EB%93%9C-%ED%95%98%EB%8A%94-%EB%B0%A9%EC%8B%9D\" aria-label=\"spring에서 파일업로드 하는 방식 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>spring에서 파일업로드 하는 방식</h2>\n<ul>\n<li>\n<p>스프링 부트로 파일을 업로드 하는데 두가지 방식이 있다.</p>\n<ol>\n<li>별도의 업로드 라이브러리(commons - fileupload 등)</li>\n<li>Servlet 3버전 이후로 사용가능한 자체 파일 업로드 라이브러리</li>\n</ol>\n</li>\n</ul>\n<h2 id=\"파일-업로드를-위한-설정\" style=\"position:relative;\"><a href=\"#%ED%8C%8C%EC%9D%BC-%EC%97%85%EB%A1%9C%EB%93%9C%EB%A5%BC-%EC%9C%84%ED%95%9C-%EC%84%A4%EC%A0%95\" aria-label=\"파일 업로드를 위한 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>파일 업로드를 위한 설정</h2>\n<ul>\n<li>\n<p>spring servlet 파일 업로드를 위한 설정 (spring.servlet.multipart)</p>\n<ul>\n<li>enabled : 파일 업로드 가능 여부를 선택</li>\n<li>location : 업로드 된 파일의 임시저장경로</li>\n<li>max-request-size : 한 번에 최대 업로드 가능 용량</li>\n<li>max-file-size : 파일 하나의 최대 크기</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">spring.servlet.multipart.enabled=true\nspring.servlet.multipart.location=/Users/nhn/Workspace/upload\nspring.servlet.multipart.max-request-size = 30MB\nspring.servlet.multipart.max-file-size = 10MB</code></pre></div>\n<h2 id=\"파일-업로드-시-고려해야할-사항들\" style=\"position:relative;\"><a href=\"#%ED%8C%8C%EC%9D%BC-%EC%97%85%EB%A1%9C%EB%93%9C-%EC%8B%9C-%EA%B3%A0%EB%A0%A4%ED%95%B4%EC%95%BC%ED%95%A0-%EC%82%AC%ED%95%AD%EB%93%A4\" aria-label=\"파일 업로드 시 고려해야할 사항들 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>파일 업로드 시 고려해야할 사항들</h2>\n<ul>\n<li>업로드된 확장자가 이미지만 가능하도록 검사(첨부파일을 이요한 원격 셀)</li>\n<li>동일한 이름의 파일이 업로드 된다면 기존 파일을 덮어쓰는 문제</li>\n<li>업로드된 파일을 저장하는 폴더의 용량</li>\n</ul>\n<h3 id=\"동일-파일명-문제\" style=\"position:relative;\"><a href=\"#%EB%8F%99%EC%9D%BC-%ED%8C%8C%EC%9D%BC%EB%AA%85-%EB%AC%B8%EC%A0%9C\" aria-label=\"동일 파일명 문제 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>동일 파일명 문제</h3>\n<ul>\n<li>기존의 파일이 사라지고 새로운 파일로 변경되기 때문에 주의</li>\n<li>\n<p>이를 막기 위해서 고유한 이름을 생성해 파일이름으로 사용</p>\n<ul>\n<li>시간 값을 파일 이름에 추가하거나</li>\n<li>UUID를 이용해서 고유한 값을 만들어서 사용</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"동일한-파일에-너무-많은-파일-저장\" style=\"position:relative;\"><a href=\"#%EB%8F%99%EC%9D%BC%ED%95%9C-%ED%8C%8C%EC%9D%BC%EC%97%90-%EB%84%88%EB%AC%B4-%EB%A7%8E%EC%9D%80-%ED%8C%8C%EC%9D%BC-%EC%A0%80%EC%9E%A5\" aria-label=\"동일한 파일에 너무 많은 파일 저장 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>동일한 파일에 너무 많은 파일 저장</h3>\n<ul>\n<li>\n<p>한 폴더 내에 너무 많은 파일이 쌓이면 성능이 저하됨</p>\n<ul>\n<li>운영체제에 따라 하나의 폴더에 넣을 수 있는 파일의 수도 제한</li>\n<li>일반적으로 가장 많이 쓰이는 방법은 파일이 저장되는 시점을 저장해서 년/월/일로 구분해서 쓰는 것</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"파일의-확장자-체크\" style=\"position:relative;\"><a href=\"#%ED%8C%8C%EC%9D%BC%EC%9D%98-%ED%99%95%EC%9E%A5%EC%9E%90-%EC%B2%B4%ED%81%AC\" aria-label=\"파일의 확장자 체크 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>파일의 확장자 체크</h3>\n<ul>\n<li>\n<p>첨부파일을 이용해 쉘 스크립트 파일 등을 업로드해서 공격하는 기법도 있기 때문에, 이를 검사하는 과정을 거쳐야함</p>\n<ul>\n<li>multipartFile에서 제공하는 getContentType()를 이용해서 처리 가능</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"섬네일-이미지-생성과-화면처리\" style=\"position:relative;\"><a href=\"#%EC%84%AC%EB%84%A4%EC%9D%BC-%EC%9D%B4%EB%AF%B8%EC%A7%80-%EC%83%9D%EC%84%B1%EA%B3%BC-%ED%99%94%EB%A9%B4%EC%B2%98%EB%A6%AC\" aria-label=\"섬네일 이미지 생성과 화면처리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>섬네일 이미지 생성과 화면처리</h3>\n<ul>\n<li>원본 이미지를 노출하기에는 데이터를 많이 소비해야 하기 때문에, 섬네일을 만들어 전송합니다.</li>\n<li>\n<p>이미지 처리는 다음과 같은 과정으로 처리합니다.</p>\n<ul>\n<li>업로드된 파일을 저장하고 섬네일 라이브러리를 활용해서 섬네일 파일을 만들어준다.</li>\n<li>섬네일 파일은 파일의 맨 앞에 ‘s_‘를 붙여서 구분한다.</li>\n<li>ResultDTO에 getThumbnailURL()을 추가해서 섬네일의 경로를 <code class=\"language-text\">&lt;img&gt;</code> 태그로 처리</li>\n</ul>\n</li>\n<li>섬네일 처리를 위해 java.imageio 패키지 이용가능 / Thumbnailator 라이브러리를 사용</li>\n</ul>\n<h1 id=\"chapter9\" style=\"position:relative;\"><a href=\"#chapter9\" aria-label=\"chapter9 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Chapter9</h1>\n<p>Chapter 9 의 경우 책의 내용을 따라하면 무리없이 진행할 수 있었다.<br>\n따라서 따로 글은 작성하지 않겠다.</p>","fields":{"slug":"/posts/TIL/Spring Boot/코드로-배우는-스프링부트/part4/파일 업로드 처리","tagSlugs":["/tag/코드로-배우는-스프링부트/","/tag/spring/","/tag/spring-boot/","/tag/maria-db/","/tag/thymeleaf/"]},"frontmatter":{"date":"2021-01-20T23:46:37.121Z","description":"코드로 배우는 스프링부트 part4/chapter7 파일 업로드 처리","tags":["코드로-배우는-스프링부트","Spring","Spring Boot","MariaDB","Thymeleaf"],"title":"파일 업로드 처리","socialImage":null}}},"pageContext":{"slug":"/posts/TIL/Spring Boot/코드로-배우는-스프링부트/part4/파일 업로드 처리"}},"staticQueryHashes":["251939775","401334301","825871152"]}